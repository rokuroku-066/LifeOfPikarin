* Python 実装（`src/python/terrarium`）は決定論的な Simulation Core と、スナップショットを配信する Web サーバーで構成される。クライアントは状態を読み取るだけで書き込まない。
# 識 蜈ｨ菴薙さ繝ｳ繧ｻ繝励ヨ縺ｨ險ｭ險域婿驥

## 逶ｮ逧

* 菫ｯ迸ｰ蝗ｺ螳壹き繝｡繝ｩ縺ｧ**髟ｷ譎る俣逵ｺ繧√ｉ繧後ｋ譏蜒丈ｽ懷刀**縺ｨ縺励※縺ｮ邂ｱ蠎ｭ繧ｷ繝溘Η繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ縲
* 譛蛻昴�**縺溘□縺ｮ繧ｭ繝･繝ｼ繝也ｾ､**縺ｨ縺励※螳溯｣�＠縲√◎縺ｮ蠕**FBX繝｢繝�Ν�九い繝九Γ繝ｼ繧ｷ繝ｧ繝ｳ**縺ｸ蟾ｮ縺玲崛縺亥庄閭ｽ縺ｪ讒矩縲
* 蛟倶ｽ薙� Alife 逧�↓

  * 遘ｻ蜍
  * 謌宣聞
  * 郢∵ｮ
  * 豁ｻ
    繧堤ｹｰ繧願ｿ斐＠縲
    **隍�焚縺ｮ繧ｰ繝ｫ繝ｼ繝暦ｼ医さ繝ｭ繝九��峨′閾ｪ辟ｶ縺ｫ蠖｢謌舌＆繧後ｋ**繧医≧縺ｪ蜑ｵ逋ｺ繧堤漁縺�
* 繝代ヵ繧ｩ繝ｼ繝槭Φ繧ｹ荳翫**O(Nﾂｲ)縺ｮ蜈ｨ繝壹い蛻､螳壹�遖∵ｭ｢**縲らｩｺ髢薙げ繝ｪ繝�ラ縺ｧ霑大ｍ縺ｮ縺ｿ繧呈桶縺�

## 險ｭ險医�蝓ｺ譛ｬ蜴溷援

1. **View 縺ｨ Simulation��odel�峨�螳悟�蛻�屬**

   * Simulation Core 縺ｯ**謨ｰ蛟､縺ｨ繝ｭ繧ｸ繝�け縺縺**繧呈桶縺�√げ繝ｩ繝輔ぅ繧ｯ繧ｹ繧�い繝九Γ繝ｼ繧ｷ繝ｧ繝ｳ縺ｫ萓晏ｭ倥＠縺ｪ縺�
   * View 縺ｯ Simulation 縺ｮ迥ｶ諷九ｒ**隱ｭ縺ｿ蜿悶▲縺ｦ謠冗判縺吶ｋ縺縺**縺ｧ縲ヾim蛛ｴ縺ｮ迥ｶ諷九ｒ譖ｸ縺肴鋤縺医↑縺�
   * FBX繧｢繝九Γ繝ｼ繧ｷ繝ｧ繝ｳ縺ｮ螳御ｺ�ｒ蠕�▲縺ｦ迥ｶ諷矩�遘ｻ繧呈ｭ｢繧√ｋ縲√↑縺ｩ**繧｢繝九Γ驛ｽ蜷医〒Sim繧呈ｭ｢繧√ｋ縺薙→縺ｯ遖∵ｭ｢**縲

2. **蝗ｺ螳壹せ繝�ャ繝励�譎る俣髮｢謨｣蛹**

   * Simulation 縺ｯ蝗ｺ螳墅杯�井ｾ具ｼ1/30遘抵ｼ峨〒騾ｲ繧縲
   * 謠冗判繝輔Ξ繝ｼ繝繝ｬ繝ｼ繝医→蛻�屬�医Ξ繝ｳ繝繝ｪ繝ｳ繧ｰ縺ｯ陬憺俣縺励※霑ｽ蠕難ｼ峨
   * 縺薙ｌ縺ｫ繧医ｊ髟ｷ譛滓嫌蜍輔′螳牙ｮ夲ｼ��迴ｾ諤ｧ縺梧球菫昴＠繧�☆縺�

3. **雋縺ｮ繝輔ぅ繝ｼ繝峨ヰ繝�け繧貞�阡ｵ縺励◆縲瑚�蟾ｱ隱ｿ謨ｴ縲**

   * 蛟倶ｽ捺焚縺ｯ閾ｪ辟ｶ縺ｫ

     * **蜈ｨ貊**
     * **辟｡髯仙｢玲ｮ**
       縺ｫ陦後″縺後■縺ｪ縺ｮ縺ｧ縲
   * 繧ｨ繝阪Ν繧ｮ繝ｼ豸郁ｲｻ縲�｣滓侭譫ｯ貂��℃蟇�せ繝医Ξ繧ｹ縲∫羅豌励↑縺ｩ繧帝壹§縺ｦ
     **螻謇蟇�ｺｦ縺ｫ蠢懊§縺溯�辟ｶ貂帛ｰ代Γ繧ｫ繝九ぜ繝**繧貞�繧後※縺翫￥縲

4. **繧ｰ繝ｪ繝�ラ繝吶�繧ｹ縺ｮ遨ｺ髢楢ｪ崎ｭ**

   * Reynolds 縺ｮ Boids 縺ｮ繧医≧縺ｫ縲∫ｾ､繧梧嫌蜍輔�縲悟ｱ謇霑大ｍ縺縺代ｒ隕九ｋ縲堺ｻ慕ｵ�∩縺ｧ蜊∝�縺ｫ蜑ｵ逋ｺ縺悟�繧九([red3d.com][1])
   * 遨ｺ髢薙げ繝ｪ繝�ラ��patial Hash�峨ｒ逕ｨ縺�※霑大ｍ繧帝ｫ倬溷叙蠕励＠縲**蜈ｨ蛟倶ｽ薙�繧｢謗｢邏｢繧貞屓驕ｿ**縲

5. **Utility繝吶�繧ｹ縺ｮ諢乗晄ｱｺ螳夲ｼ九す繝ｳ繝励ΝFSM**

   * 繧ｲ繝ｼ繝AI縺ｧ荳闊ｬ逧�↑ Utility-based Agent 縺ｮ繧医≧縺ｫ縲
     縲瑚､�焚縺ｮ谺ｲ豎ゑｼ域ｺ閻ｹ縲∫ｹ∵ｮ悶∝些髯ｺ蝗樣∩窶ｦ�峨↓繧ｹ繧ｳ繧｢繧剃ｻ倥￠縺ｦ荳逡ｪ鬮倥＞陦悟虚繧帝∈縺ｶ縲肴ｧ矩縲([GeeksforGeeks][2])
   * 鬮倥Ξ繝吶Ν縺ｧ縺ｯ譛蛾剞迥ｶ諷区ｩ滓｢ｰ��SM�峨〒迥ｶ諷九ｒ譏守､ｺ縺励∬ｦ冶ｦ夂噪縺ｫ蛻�°繧翫ｄ縺吶￥縺吶ｋ縲

6. **窶懊げ繝ｫ繝ｼ繝励′縺ｧ縺阪ｄ縺吶￥縲∫ｶｭ謖√＆繧後ｄ縺吶＞窶晁�蜿ｰ險ｭ險**

   * 雉�ｺ舌ヱ繝�メ縲�⊆莨晉噪縺ｪ濶ｲ繧ｿ繧ｰ縲∝ｷ｣�医ロ繧ｹ繝茨ｼ峨ｄ繝輔ぉ繝ｭ繝｢繝ｳ蝣ｴ縺ｪ縺ｩ繧堤ｵ�∩蜷医ｏ縺帙※縲
     縲御ｸ縺､縺ｮ蟾ｨ螟ｧ縺ｪ蝗｣蟄舌阪〒縺ｯ縺ｪ縺上**隍�焚縺ｮ繧ｳ繝ｭ繝九�縺ｫ閾ｪ辟ｶ蛻�ｯ縺吶ｋ**繧医≧隱伜ｰ弱☆繧九

---

# 1. 繝ｬ繧､繝､讒区��郁ｲｬ蜍吶�蛻�屬�

### Layer 1: Simulation Core�井ｸ也阜縺ｮ譛ｬ菴難ｼ

**雋ｬ蜍**

* 逕溷多繝ｻ雉�ｺ舌�迺ｰ蠅��譎る俣縺ｫ髢｢縺吶ｋ縺吶∋縺ｦ縺ｮ繝ｭ繧ｸ繝�け縲

**荳ｻ縺ｪ繧ｳ繝ｳ繝昴�繝阪Φ繝**

* **WorldManager**

  * 繧ｷ繝溘Η繝ｬ繝ｼ繧ｷ繝ｧ繝ｳ譎る俣縺ｮ邂｡逅�ｼ亥崋螳壹せ繝�ャ繝鈴ｲ陦鯉ｼ峨
  * 蜷�し繝悶す繧ｹ繝�Β�育腸蠅��AI繝ｻ迚ｩ逅��逕溽黄繧ｵ繧､繧ｯ繝ｫ�峨ｒ鬆�分縺ｫ蜻ｼ縺ｶ縲

* **EntityManager**

  * Agent�亥倶ｽ難ｼ峨�逕滓�繝ｻ蜑企勁縲
  * Agent 縺ｮ驟榊��医∪縺溘�繝ｪ繧ｹ繝茨ｼ臥ｮ｡逅�
  * 豁ｻ莠｡繝輔Λ繧ｰ縺檎ｫ九▲縺溷倶ｽ薙�蠕悟�逅�

* **SpatialGrid**

  * 遨ｺ髢薙ｒ蝗ｺ螳壹し繧､繧ｺ繧ｻ繝ｫ縺ｫ蛻�牡縺励∝推繧ｻ繝ｫ縺ｫ蛟倶ｽ的D繝ｪ繧ｹ繝医ｒ謖√▽縲
  * 霑大ｍ讀懃ｴ｢�郁�繧ｻ繝ｫ�矩團謗･繧ｻ繝ｫ縺ｮ襍ｰ譟ｻ�峨ｒ謠蝉ｾ帙

* **EnvironmentSystem**

  * 鬟滓侭繝代ャ繝√�逕滓�繝ｻ蜀咲函�医Μ繧ｹ繝昴�繝ｳ�峨
  * 蜊ｱ髯ｺ繧ｨ繝ｪ繧｢繝ｻ蛹ゅ＞蝣ｴ�医ヵ繧ｧ繝ｭ繝｢繝ｳ繝輔ぅ繝ｼ繝ｫ繝会ｼ峨�諡｡謨｣繝ｻ貂幄｡ｰ縲
  * 蜷�そ繝ｫ蜊倅ｽ阪〒縺ｮ縲瑚ｳ�ｺ宣㍼縲阪悟些髯ｺ蠎ｦ縲阪悟ｱ�ｿ�慍蠎ｦ縲阪↑縺ｩ繧呈峩譁ｰ縲

* **AISystem**

  * 蜷Бgent縺ｫ蟇ｾ縺励∬ｿ大ｍ縺ｨ迺ｰ蠅�°繧峨梧ｬｲ豎ゅ阪→縲瑚｡悟虚縲阪ｒ豎ｺ螳壹
  * Utility險育ｮ暦ｼ祈SM縺ｫ繧医ｋ迥ｶ諷矩�遘ｻ縲

* **SteeringSystem**

  * 驕ｸ謚槭＆繧後◆陦悟虚縺ｫ蝓ｺ縺･縺阪
    Seek / Wander / Separation / Alignment / Cohesion / Avoid遲
    縺ｮ Steering 蜉帙ｒ蜷域�縺励∫岼讓咎溷ｺｦ繝ｻ譁ｹ蜷代ｒ豎ｺ螳壹([red3d.com][1])

* **LifeCycleSystem**

  * 繧ｨ繝阪Ν繧ｮ繝ｼ豸郁ｲｻ縲∵�髟ｷ縲∝ｯｿ蜻ｽ蛻､螳壹
  * 郢∵ｮ匁擅莉ｶ蛻､螳壹→譁ｰ蛟倶ｽ薙�逕滓�縲
  * 蟇�ｺｦ縺ｫ蠢懊§縺溯ｲ縺ｮ繝輔ぅ繝ｼ繝峨ヰ繝�け�育稔逞��郢∵ｮ匁椛蛻ｶ縺ｪ縺ｩ�峨ｒ驕ｩ逕ｨ縲

---

### Layer 2: Visualization�郁ｦ九◆逶ｮ�

**雋ｬ蜍**

* Simulation Core縺ｮ迥ｶ諷九ｒ隱ｭ縺ｿ蜿悶ｊ縲∫判髱｢縺ｫ謚募ｽｱ縺吶ｋ縲
* Simulation縺ｫ縺ｯ**荳蛻�嶌縺崎ｾｼ縺ｾ縺ｪ縺**縲

**荳ｻ縺ｪ繧ｳ繝ｳ繝昴�繝阪Φ繝**

* **AgentViewMapper**

  * AgentData 竊 View逕ｨ繝代Λ繝｡繝ｼ繧ｿ
    �井ｽ咲ｽｮ縲∝髄縺阪∬牡縲√せ繧ｱ繝ｼ繝ｫ縲∫憾諷紀D 縺ｪ縺ｩ�峨�螟画鋤縲

* **CubeInstancingRenderer�医ヵ繧ｧ繝ｼ繧ｺ1�**

  * 螟ｧ驥上�繧ｭ繝･繝ｼ繝悶ｒ繧､繝ｳ繧ｹ繧ｿ繝ｳ繧ｷ繝ｳ繧ｰ縺ｧ謠冗判縲
  * 陦悟��井ｽ咲ｽｮ繝ｻ蝗櫁ｻ｢繝ｻ繧ｹ繧ｱ繝ｼ繝ｫ�会ｼ玖牡縺ｪ縺ｩ縺ｮ繝舌ャ繝輔ぃ繧呈ｯ弱ヵ繝ｬ繝ｼ繝譖ｴ譁ｰ縺励※GPU縺ｸ騾√ｋ縲
  * 謨ｰ蜊�懈焚荳�ｽ薙せ繧ｱ繝ｼ繝ｫ繧呈Φ螳壹

* **FBXViewPool�医ヵ繧ｧ繝ｼ繧ｺ2�**

  * 縺ゅｋ遞句ｺｦ蟆代↑縺�焚�郁ｿ代＞蛟倶ｽ薙∽ｻ｣陦ｨ蛟倶ｽ薙↑縺ｩ�峨ｒFBX繝｢繝�Ν縺ｧ陦ｨ遉ｺ縲
  * 谿九ｊ縺ｯ繧ｭ繝･繝ｼ繝悶ｄ繝薙Ν繝懊�繝芽｡ｨ迴ｾ縺ｫ關ｽ縺ｨ縺儉OD繧よ､懆ｨ弱
  * Animator 縺ｫ縺ｯ Sim蛛ｴ縺ｮ縲碁溷ｺｦ縲阪檎憾諷九阪梧�髟ｷ谿ｵ髫弱阪↑縺ｩ繧呈ｸ｡縺吶′縲
    Animator縺ｮ莠区ュ縺ｧSim繝ｭ繧ｸ繝�け繧呈ｭ｢繧√↑縺�

---

### Layer 3: Data & Config�磯⊆莨晏ｭ舌→荳也阜險ｭ螳夲ｼ

**雋ｬ蜍**

* 險ｭ螳壼､繝ｻ荵ｱ謨ｰ繧ｷ繝ｼ繝峨�驕ｺ莨晄ュ蝣ｱ繝ｻ蛻晄悄繝ｯ繝ｼ繝ｫ繝画ｧ区�繧剃ｸ蜈�ｮ｡逅�
* 螳滄ｨ難ｼ丈ｽ懷刀縺ｮ繝舌�繧ｸ繝ｧ繝ｳ縺斐→縺ｫ繝代Λ繝｡繝ｼ繧ｿ繧剃ｿ晏ｭ倥＠縺ｦ蜀咲樟蜿ｯ閭ｽ縺ｫ縺吶ｋ縲

**荳ｻ縺ｪ繝��繧ｿ**

* **SimulationConfig**

  * 荵ｱ謨ｰ繧ｷ繝ｼ繝
  * 繝ｯ繝ｼ繝ｫ繝峨し繧､繧ｺ
  * 繧ｿ繧､繝繧ｹ繝�ャ繝
  * 蛻晄悄蛟倶ｽ捺焚
  * 雉�ｺ舌ヱ繝�メ縺ｮ謨ｰ繝ｻ菴咲ｽｮ繝ｻ蜀咲函騾溷ｺｦ

* **AgentGenetics / SpeciesConfig**

  * 蟷ｳ蝮�ｯｿ蜻ｽ繝ｻ蟇ｿ蜻ｽ縺ｰ繧峨▽縺
  * 蝓ｺ譛ｬ遘ｻ蜍暮溷ｺｦ繝ｻ蜉騾
  * 隕夜㍽蜊雁ｾ��隕夜㍽隗
  * 蝓ｺ譛ｬ莉｣隰晞㍼
  * 繧ｰ繝ｫ繝ｼ繝励ち繧ｰ�郁牡逶ｸ�峨�縺昴�螟臥焚蟷

* **FeedbackConfig**

  * 蛟倶ｽ捺焚荳企剞縲∝ｯ�ｺｦ縺励″縺�､
  * 蟇�ｺｦ縺ｫ繧医ｋ郢∵ｮ匁椛蛻ｶ邇
  * 逍ｫ逞�匱逕溽｢ｺ邇�↑縺ｩ

---

* ID / 世代（0, 1, 2, …）
* グループID（群れの所属。未所属は `-1`）

* 2D 位置ベクトル (`Vec2`)
* 速度ベクトル（加速度上限と速度上限でクリップ）

* 年齢（秒換算）
* ストレス（局所密度で増減）
* `alive` フラグ（死亡処理の遅延削除に利用）

**内部状態（行動状態）**
* `AgentState`: `Wander` / `SeekingFood` / `SeekingMate` / `Flee` / `Idle`
* `SimulationConfig.species` で定義された速度・視野・代謝・寿命などのパラメータセットを共有する（現行は単一種）。

現行 Python 実装では Utility テーブルはまだ持たず、上記状態をエネルギー・年齢・環境勾配から直接切り替えるシンプルなヒューリスティックで運用している。

* ワールドを固定セル（例：2.5m）に区切る。
* 各セルは `GridEntry(id, position)` のリストを持つ。
* Python 実装では「毎フレーム全セルをクリア→全Agentを登録」を行い、リストを再利用して不要なアロケーションを抑えている。
* Agent が近傍を調べるときは、視野半径とセルサイズから算出した範囲（デフォルトは自セル＋周囲 1〜2 セル）だけを見る。
* 距離の二乗比較で円形の視野を切り、計算量を O(N × 近傍数) に抑える。
* **食料セル**
  * `FoodCell(value, max, regen_per_second)` をセル単位で管理し、`consume_food` / `add_food` で出入りを制御する。
  * デフォルトのセル上限・再生速度に加え、`resource_patches` で初期値／上限／再生速度をセル毎に上書き可能。
  * 拡散・減衰はバッファを用いた離散畳み込みで実装し、近傍 4 セルへ均等に広がる。

* **危険フィールド**
  * `danger` スカラー場をセル単位で保持し、逃走行動 (`Flee`) や危険サインでパルスを追加する。
  * 拡散と減衰を毎ステップ適用し、危険勾配に沿って離脱ベクトルを計算する。
* **フェロモン場**
  * グループ ID を含むキー `(cell_x, cell_y, group_id)` ごとに強度を保持する。
  * 出生時に少量を追加し、拡散・減衰を通じて「コロニー中心」を形成する。

1. **初期化**
   * そのステップで発生した食料・危険・フェロモンの追加イベント用バッファをクリア。
   * 経過時間から「グループ形成を有効化するウォームアップ」を判定。
2. **SpatialGrid の再構築**

   * ID インデックスを更新し、全 Agent の位置をセルに再登録。

3. **Agent 更新ループ**

   * 近傍セルから `get_neighbors` で取得したエージェントとオフセットを一時バッファに集める。
   * グループ形成／編入／分裂を判定（ウォームアップ後のみ有効）。
   * 危険勾配や敵対グループとの接近で `Flee` を優先し、そうでなければ
     * 食料不足や勾配を検知すると `SeekingFood`
     * エネルギーと年齢が十分なら `SeekingMate`
     * それ以外は `Wander`
     の簡易 FSM を選択。
   * Separation / Alignment / Cohesion と、食料・フェロモン・危険勾配を重み付きに合成して目標速度を作り、加速度・速度を上限でクリップしながら位置を更新（トーラス状にラップ）。
   * エネルギー代謝（速度依存・高エネルギー追加消費・ストレス消耗）、局所密度によるストレス増減、食料消費、繁殖（密度ペナルティ・グループ継承／突然変異）を処理。死亡は `alive` フラグに記録し、死亡地点へ食料を還元。
   * 逃走や危険感知で危険パルスを予約し、出生したグループにはフェロモンを追加予約する。
4. **環境更新**
   * 予約された食料／危険／フェロモンをフィールドへ加算し、食料再生・拡散、危険・フェロモンの拡散と減衰を実行。
5. **出生・死亡適用**
   * 生まれた個体をまとめて追加し、死亡フラグ付きの個体をリストから除去。

6. **統計記録**

   * `TickMetrics` として個体数・出生/死亡数・平均エネルギー/年齢・グループ数・近傍チェック回数・ステップ所要時間を蓄積する。Web 用スナップショットは生存個体のみの位置・速度・グループ・状態を含む。

## 4-2. 複数グループができるための要素（現行ロジック）

1. **ウォームアップと結成**

   * シミュレーション開始から数秒間はグループ結成を禁止し、初期ランダム分布を維持する。
   * 未所属個体が一定以上の未所属近傍を持ち、確率を満たすと新しいグループを立ち上げ、周囲数体を同時に勧誘する。

2. **周囲多数派への編入**
   * 近傍で最多のグループがしきい値を超え、確率判定に通ればそのグループへ同化する。

3. **ストレスによる分裂・離脱**

   * 同一グループの近傍が多く、ストレスが閾値を超えた場合に確率で離脱。
   * 離脱時は未所属になるか、新グループに突然変異して分家する。

4. **出生・突然変異とフェロモン**
   * 繁殖で生まれる子は親のグループを継承しつつ、一定確率で ID を変異させる。未所属の親からは一定確率で新グループが芽吹く。
   * 出生地点にはそのグループのフェロモンを撒き、拡散・減衰を通じてコロニー中心を形成する。

5. **密度フィードバック**

   * 局所密度が高いほどストレス増加・繁殖成功率低下・疾病確率上昇が働き、群れが自然に分散する。
* 位置・向き：AgentData の position を反映し、向きは現在の速度ベクトルから算出。
     * Seek�磯｣滓侭/蟾｣/莠､驟咲嶌謇九↑縺ｩ縺ｮ繧ｿ繝ｼ繧ｲ繝�ヨ縺ｸ蜷代°縺�ｼ
     * Wander�医Λ繝ｳ繝繝縺ｪ謠ｺ繧峨℃縺ｧ閾ｪ辟ｶ縺輔ｒ蜃ｺ縺呻ｼ
     * ObstacleAvoid / BoundaryForce�亥｣√ｄ螟門捉縺九ｉ髮｢繧後ｋ�
   * Reynolds 縺ｮ Steering Behaviors 蜷梧ｧ倥∬､�焚縺ｮ蜊倡ｴ斐↑繝吶け繝医Ν繧帝㍾縺ｿ莉倥″縺ｧ雜ｳ縺怜粋繧上○繧九す繝ｳ繝励Ν縺ｪ繝｢繝�Ν縲([red3d.com][1])

6. **驕句虚譖ｴ譁ｰ��ntegration�**

   * Steering邨先棡縺九ｉ騾溷ｺｦ繧呈峩譁ｰ縺励�溷ｺｦ繧剃ｸ企剞縺ｧ蛻ｶ髯舌
   * 菴咲ｽｮ繧呈峩譁ｰ縺励√Ρ繝ｼ繝ｫ繝牙､悶↓蜃ｺ縺ｪ縺�ｈ縺�｣懈ｭ｣縲
   * 邁｡譏鍋噪縺ｪ謚ｼ縺怜�縺暦ｼ磯㍾縺ｪ繧願ｧ｣豸茨ｼ峨� Separation 縺ｮ蠑ｷ縺輔〒蜷ｸ蜿弱☆繧玖ｨｭ險医〒繧ゅｈ縺�

7. **逕溽黄蟄ｦ逧�峩譁ｰ��ifeCycle�**

   * 譎る俣邨碁℃縺ｫ繧医ｋ蟷ｴ鮨｢�区�髟ｷ谿ｵ髫弱�譖ｴ譁ｰ縲
   * 遘ｻ蜍戊ｷ晞屬縺ｪ縺ｩ縺ｫ蠢懊§縺溘お繝阪Ν繧ｮ繝ｼ豸郁ｲｻ縲
   * 繧ｨ繝阪Ν繧ｮ繝ｼ0莉･荳九ｄ蟇ｿ蜻ｽ雜�℃縺ｧ豁ｻ莠｡繝輔Λ繧ｰ繧堤ｫ九※繧九

8. **郢∵ｮ厄ｼ�ｭｻ莠｡蜃ｦ逅**

   * 郢∵ｮ匁擅莉ｶ繧呈ｺ縺溘☆繝壹い繧偵∬ｿ大ｍ蜀�°繧蛾∈謚槭
   * 譁ｰ蛟倶ｽ薙ｒ逕滓�縺励∬ｦｪ縺ｮ驕ｺ莨晏ｭ撰ｼ句ｰ上Λ繝ｳ繝繝螟臥焚縺ｧTraits繧呈ｱｺ螳壹
   * 豁ｻ莠｡繝輔Λ繧ｰ縺ｮ遶九▲縺溷倶ｽ薙ｒ蜑企勁縺励
     縺昴�菴咲ｽｮ縺ｫ繧上★縺九↑雉�ｺ撰ｼ磯｣滓侭�峨ｒ驍��縺吶ｋ縺ｪ縺ｩ縺ｮ蠕ｪ迺ｰ繧貞�繧後ｋ縲

9. **雋縺ｮ繝輔ぅ繝ｼ繝峨ヰ繝�け驕ｩ逕ｨ**

   * 繧ｰ繝ｭ繝ｼ繝舌Ν縺ｪ邱丞倶ｽ捺焚縺ｨ縲√そ繝ｫ縺斐→縺ｮ螻謇蟇�ｺｦ繧定ｩ穂ｾ｡縲
   * 蟇�ｺｦ縺碁ｫ倥☆縺弱ｋ繧ｻ繝ｫ縺ｧ縺ｯ�

     * 繧ｨ繝阪Ν繧ｮ繝ｼ豸郁ｲｻ蠅怜刈
     * 郢∵ｮ匁�蜉溽紫菴惹ｸ
     * 逍ｫ逞�ｼ医Λ繝ｳ繝繝豁ｻ莠｡遒ｺ邇�ｼ峨�逋ｺ逕 縺ｪ縺ｩ繧帝←逕ｨ縺励
       **驕主ｯ�憾諷九ｒ閾ｪ辟ｶ縺ｫ隗｣豸医☆繧区婿蜷**縺ｸ謚ｼ縺吶

10. **邨ｱ險医�繝ｭ繧ｰ譖ｴ譁ｰ**

    * 蛟倶ｽ捺焚縲∫ｾ､繧後�謨ｰ縲∝ｹｳ蝮�ｯｿ蜻ｽ縲∵ｭｻ莠｡蜴溷屏蛻�ｸ�↑縺ｩ繧貞庶髮�
    * 繧｢繝ｼ繝井ｽ懷刀縺ｨ縺励※驥崎ｦ√↑譛滄俣繧呈､懷�繝ｻ險倬鹸縺吶ｋ縺溘ａ縺ｮ繝｡繧ｿ繝��繧ｿ縺ｨ縺励※菫晏ｭ倥

---

# 4. 陦悟虚豎ｺ螳壹→鄒､繧悟ｽ｢謌舌�莉墓寺縺

## 4-1. Utility�祈SM縺ｫ繧医ｋ陦悟虚豎ｺ螳

**蛟呵｣懆｡悟虚縺ｮ萓**

* 鬟滉ｺ具ｼ�orage / Eat�
* 謗｢邏｢��ander�
* 鄒､繧瑚｡悟虚��lock�
* 郢∵ｮ厄ｼ�eekMate / Mate�
* 莨第���est�
* 蜊ｱ髯ｺ蝗樣∩��lee�

**Utility險育ｮ励�蝓ｺ譛ｬ**

* 陦悟虚縺斐→縺ｫ縲√悟ｯｾ蠢懊☆繧区ｬｲ豎ゅラ繝ｩ繧､繝悶搾ｼ九檎腸蠅�擅莉ｶ縲阪°繧峨せ繧ｳ繧｢繧定ｨ育ｮ励
* 萓具ｼ

  * 鬟滉ｺ具ｼ夂ｩｺ閻ｹ蠎ｦ縺碁ｫ倥￥縲∬ｿ代￥縺ｫ雉�ｺ舌′縺ゅｋ縺ｨ縺阪せ繧ｳ繧｢荳頑�縲
  * 郢∵ｮ厄ｼ壹お繝阪Ν繧ｮ繝ｼ縺悟香蛻�〒縲∬ｿ代￥縺ｫ逶ｸ諤ｧ縺ｮ濶ｯ縺�嶌謇九′縺�ｋ縺ｨ縺阪せ繧ｳ繧｢荳頑�縲
  * 莨第��壹お繝阪Ν繧ｮ繝ｼ縺ｯ縺ゅｋ縺後∵ｴｻ蜍墓凾髢薙′髟ｷ縺冗夢蜉ｴ縺励※縺�ｋ縺ｨ縺阪せ繧ｳ繧｢荳頑�縲

**FSM縺ｨ縺ｮ髢｢菫**

* Utility縺ｧ縲梧ｬ｡縺ｫ繧�ｊ縺溘＞陦悟虚縲阪ｒ豎ｺ繧√ｋ縲
* FSM縺ｯ縲御ｻ翫�迥ｶ諷九′菴輔〒縲√＞縺､邨ゅ∴繧九°縲阪ｒ邂｡逅�ｼ

  * 萓具ｼ夐｣滉ｺ狗憾諷九↓蜈･縺｣縺溘ｉ縲∽ｸ螳壽凾髢登r貅閻ｹ縺ｫ縺ｪ繧九∪縺ｧ邯壹￠繧九
* 縺薙ｌ縺ｫ繧医ｊ縲、morphous Fortress 縺ｮ繧医≧縺ｪFSM繝吶�繧ｹ縺ｮ螟壹お繝ｼ繧ｸ繧ｧ繝ｳ繝育ｳｻ縺ｧ隕九ｉ繧後ｋ
  **窶懆｡悟虚縺ｮ縺ｾ縺ｨ縺ｾ繧岩昴→窶懷卸逋ｺ窶**繧堤ｶｭ謖√＠縺､縺､縲ゞtility縺ｧ譟碑ｻ滓ｧ繧呈戟縺溘○繧九([arXiv][5])

---

## 4-2. 隍�焚繧ｰ繝ｫ繝ｼ繝励′縺ｧ縺阪ｋ縺溘ａ縺ｮ隕∫ｴ

1. **雉�ｺ舌ヱ繝�メ縺ｮ蛻�ｸ**

   * 繝槭ャ繝励↓隍�焚縺ｮ雉�ｺ舌ヱ繝�メ繧帝�鄂ｮ�井ｾ具ｼ3縲7邂�園�峨
   * 縺昴ｌ縺槭ｌ蜀咲函騾溷ｺｦ繧�ｮ牙�蠎ｦ繧貞ｾｮ螯吶↓螟峨∴繧九
   * 鄒､繧後�閾ｪ辟ｶ縺ｫ縺昴ｌ縺槭ｌ縺ｮ繝代ャ繝∝捉霎ｺ縺ｫ螳壻ｽ上＠繧�☆縺上↑繧九

2. **繧ｰ繝ｫ繝ｼ繝励ち繧ｰ�郁牡逶ｸ�峨→驕ｺ莨晉噪隕ｪ蜥梧ｧ**

   * 蜷�倶ｽ薙� `繧ｰ繝ｫ繝ｼ繝励ち繧ｰ�郁牡逶ｸ蛟､�荏 繧呈戟縺｡縲√◎繧後′隕九◆逶ｮ縺ｮ濶ｲ縺ｫ繧ょ渚譏縺輔ｌ繧九
   * Steering 縺ｮ Cohesion / Alignment 縺ｮ蠑ｷ縺輔ｒ縲√ち繧ｰ鬘樔ｼｼ蠎ｦ縺ｫ蠢懊§縺ｦ螟牙喧縺輔○繧具ｼ

     * 莨ｼ縺溘ち繧ｰ縺ｫ縺ｯ Cohesion 繧貞ｼｷ縺
     * 逡ｰ縺ｪ繧九ち繧ｰ縺ｫ縺ｯ Separation 繧偵ｄ繧�ｼｷ縺
   * 蟄舌←繧ゅ�隕ｪ縺ｮ繧ｿ繧ｰ繧堤ｶ呎価縺励▽縺､縲∝ｰ上＆縺ｪ螟臥焚繧貞刈縺医ｋ縲
     竊 縺薙ｌ縺ｫ繧医ｊ縲**濶ｲ縺斐→縺ｮ鄒､繧後�陦邨ｱ**縺瑚�辟ｶ縺ｫ蛻�ｲ舌＠繧�☆縺上↑繧九

3. **蟾｣��est�峨→繝輔ぉ繝ｭ繝｢繝ｳ蝣ｴ**

   * 郢∵ｮ悶′謌仙粥縺励◆蝨ｰ轤ｹ縺ｫ縲悟ｷ｣縲阪ｒ蠖｢謌舌＠縲√◎縺ｮ蜻ｨ蝗ｲ縺ｫ繝輔ぉ繝ｭ繝｢繝ｳ蝣ｴ繧堤匱逕溘＆縺帙ｋ縲
   * 繝輔ぉ繝ｭ繝｢繝ｳ蝣ｴ縺ｯ譎る俣縺ｨ縺ｨ繧ゅ↓貂幄｡ｰ縺吶ｋ縺後∝酔繧ｰ繝ｫ繝ｼ繝励ち繧ｰ縺ｮ蛟倶ｽ薙�縺昴％繧偵悟ｱ�ｿ�慍縺瑚憶縺�阪→諢溘§縺ｦ謌ｻ繧翫ｄ縺吶￥縺ｪ繧九
   * 邨先棡縺ｨ縺励※縲**繧ｰ繝ｫ繝ｼ繝励＃縺ｨ縺ｮ窶懊さ繝ｭ繝九�荳ｭ蠢�慍窶昴′縺ｧ縺阪ｋ**縲

4. **驕主ｯ�椛蛻ｶ縺ｫ繧医ｋ蛻�淵**

   * 荳縺､縺ｮ雉�ｺ舌ヱ繝�メ繧�ｷ｣蜻ｨ霎ｺ縺碁℃蟇�↓縺ｪ繧九→縲√◎縺薙↓縺�ｋ蛟倶ｽ薙�

     * 繧ｨ繝阪Ν繧ｮ繝ｼ豸郁ｲｻ蠅怜刈
     * 郢∵ｮ匁�蜉溽紫菴惹ｸ
       縺ｪ縺ｩ縺ｮ繝壹リ繝ｫ繝�ぅ繧偵°縺代ｋ縲
   * 縺薙ｌ縺ｫ繧医ｊ荳驛ｨ縺ｯ莉悶�雉�ｺ舌ヱ繝�メ縺ｸ遘ｻ菴上＠縲∽ｸ也阜蜈ｨ菴薙〒**隍�焚縺ｮ繧ｳ繝ｭ繝九�縺悟�蟄**縺励ｄ縺吶￥縺ｪ繧九

---

# 5. View險ｭ險茨ｼ壹く繝･繝ｼ繝 竊 FBX縺ｸ縺ｮ繧ｹ繝繝ｼ繧ｺ縺ｪ遘ｻ陦

## 5-1. Phase 1�壹く繝･繝ｼ繝冶｡ｨ迴ｾ

**逶ｮ逧**

* 繧ｷ繧ｹ繝�Β蜈ｨ菴薙�繝ｭ繧ｸ繝�け繝ｻ繝代Λ繝｡繝ｼ繧ｿ繝ｻ蜑ｵ逋ｺ繝代ち繝ｼ繝ｳ縺ｮ讀懆ｨｼ繧
  鬮倥ヱ繝輔か繝ｼ繝槭Φ繧ｹ縺ｧ陦後≧繝輔ぉ繝ｼ繧ｺ縲

**陦ｨ迴ｾ繝ｫ繝ｼ繝ｫ縺ｮ萓**

* 菴咲ｽｮ繝ｻ蜷代″�哂gentData 縺ｮ position / heading 繧偵◎縺ｮ縺ｾ縺ｾ蜿肴丐縲
* 濶ｲ逶ｸ�壹げ繝ｫ繝ｼ繝励ち繧ｰ�郁｡邨ｱ�峨ｒ逶ｴ謗･濶ｲ縺ｫ繝槭ャ繝斐Φ繧ｰ縲
* 譏主ｺｦ繝ｻ霈晏ｺｦ�壹お繝阪Ν繧ｮ繝ｼ驥上ｒ蜿肴丐�亥ｼｱ繧九→證励￥縺ｪ繧九↑縺ｩ�峨
* 繧ｹ繧ｱ繝ｼ繝ｫ�

  * 蟄舌←繧ゑｼ壼ｰ上＆縺
  * 螟ｧ莠ｺ�壽ｨ呎ｺ悶し繧､繧ｺ
  * 閠√＞�壹ｄ繧�ｸｮ繧 or 謠ｺ繧峨℃縺悟｢励☆
* 逋ｺ蜈峨ｄ繝代Ν繧ｹ�

  * 郢∵ｮ門庄閭ｽ迥ｶ諷具ｼ�epro谺ｲ豎ゅ′鬮倥＞縺ｨ縺搾ｼ峨↓豺｡縺�せ貊�ｒ蜈･繧後ｋ縲

縺薙ｌ縺縺代〒縲∽ｸ翫°繧芽ｦ九◆縺ｨ縺阪↓

* 縲後←縺薙↓縺ｩ繧薙↑陦邨ｱ縺ｮ鄒､繧後′縺�ｋ縺九
* 縲後←縺薙′闍･縺�さ繝ｭ繝九�縺ｧ縲√←縺薙′閠√＞縺ｦ縺�ｋ縺九
* 縲檎ｹ∵ｮ悶′豢ｻ逋ｺ縺ｪ繧ｾ繝ｼ繝ｳ縺ｯ縺ｩ縺薙°縲

縺**荳逶ｮ縺ｧ蛻�°繧狗ｵｵ**縺ｫ縺ｪ繧九

## 5-2. Phase 2�哥BX�上い繝九Γ繝ｼ繧ｷ繝ｧ繝ｳ

**蝓ｺ譛ｬ譁ｹ驥**

* Simulation蛛ｴ縺ｫ縺ｯ荳蛻�焔繧貞�繧後★縲〃iew螻､縺ｮ蟾ｮ縺玲崛縺医�縺ｿ縺ｧ螳溽樟縲
* 蛟九��FBX縺ｯ 窶應ｻ｣陦ｨ逧�↑蛟倶ｽ凪 繧 窶懊き繝｡繝ｩ縺ｫ霑代＞蛟倶ｽ凪 縺ｫ髯仙ｮ壹＠縲
  驕譎ｯ縺ｯ蠑輔″邯壹″繧ｭ繝･繝ｼ繝悶ｄ邁｡譏薙Δ繝�Ν縺ｧ陦ｨ迴ｾ��OD�峨

**View縺悟女縺大叙繧区ュ蝣ｱ**

* 菴咲ｽｮ繝ｻ蜷代″
* 遘ｻ蜍暮溷ｺｦ��nimator縺ｮSpeed縺ｫ蜿肴丐�
* 陦悟虚迥ｶ諷具ｼ�dle / Walk / Eat / Mate / Sleep 縺ｪ縺ｩ�
* 謌宣聞谿ｵ髫趣ｼ�hild / Adult / Old�

**Animator縺ｨ縺ｮ髢｢菫**

* Animation縺ｮ驕ｷ遘ｻ縺ｯ縲ヾim蛛ｴ縺ｮ迥ｶ諷紀D繧偵ヱ繝ｩ繝｡繝ｼ繧ｿ縺ｨ縺励※蜿励￠蜿悶ｋ縺ｮ縺ｿ縲
* 縲後い繝九Γ縺檎ｵゅｏ繧九∪縺ｧ迥ｶ諷矩�遘ｻ縺励↑縺�阪後い繝九Γ繝ｼ繧ｷ繝ｧ繝ｳ繧､繝吶Φ繝医〒繝ｭ繧ｸ繝�け繧貞宛蠕｡縲阪↑縺ｩ縺ｯ陦後ｏ縺ｪ縺�ｼ医≠縺上∪縺ｧ迚�婿蜷托ｼ峨

---

# 6. 髟ｷ譛溯ｦｳ蟇溽畑縺ｮ螳牙ｮ壽ｧ縺ｨ繝ｪ繧ｹ繧ｯ邂｡逅

* 全員が同じ場所に団子状態 → 資源枯渇・フェロモン拠点の複数配置・ストレス由来の分裂で分散。
* 行動がガチャガチャして読めない → 危険優先の簡易 FSM＋視覚的に判別しやすい状態 ID を維持。
* FBX化でパフォーマンスが崩壊 → LOD と GPU インスタンシングを基本とし、View 変更のみで差し替え。
    * 繧ｨ繝阪Ν繧ｮ繝ｼ豸郁ｲｻ蠅怜刈
    * 逍ｫ逞��遒ｺ邇�噪逋ｺ逕
      縺ｪ縺ｩ縺ｧ閾ｪ辟ｶ縺ｫ蟇�ｺｦ繧剃ｸ九￡繧九

* **雉�ｺ舌ム繧､繝翫Α繧ｯ繧ｹ**

  * 荳蠎ｦ鬟溘∋蟆ｽ縺上＠縺溯ｳ�ｺ舌ヱ繝�メ縺ｯ縺励�繧峨￥譫ｯ貂�＠縲√◎縺ｮ髢薙�莉悶ヱ繝�メ縺ｫ遘ｻ蜍輔○縺悶ｋ繧貞ｾ励↑縺�
  * 髟ｷ譛溽噪縺ｫ縺ｯ縲∝ｭ｣遽螟牙喧繧�Λ繝ｳ繝繝繧､繝吶Φ繝医〒雉�ｺ宣�鄂ｮ繧偵ｏ縺壹°縺ｫ謠ｺ繧峨☆縺薙→縺ｧ縲
    繧ｳ繝ｭ繝九�縺悟崋螳壹＠縺吶℃縺ｪ縺�ｈ縺�↓縺吶ｋ縲

## 6-2. 諠ｳ螳壹Μ繧ｹ繧ｯ縺ｨ險ｭ險井ｸ翫�蟇ｾ遲厄ｼ郁ｦ∫ｴ�ｼ

* 蛟倶ｽ捺焚辷�匱 竊 雋縺ｮ繝輔ぅ繝ｼ繝峨ヰ繝�け�句倶ｽ捺焚繧ｭ繝｣繝��縲
* 蜈ｨ蜩｡縺悟酔縺伜ｴ謇縺ｫ蝗｣蟄千憾諷 竊 雉�ｺ先椡貂��繧ｿ繧ｰ譁･蜉帙�蟾｣縺ｮ隍�焚驟咲ｽｮ縲
* 陦悟虚縺後ぎ繝√Ε繧ｬ繝√Ε縺励※隱ｭ繧√↑縺 竊 Utility�祈SM�九ヲ繧ｹ繝�Μ繧ｷ繧ｹ縺ｧ縲後∪縺ｨ縺ｾ繧翫阪ｒ菴懊ｋ縲
* FBX蛹悶〒繝代ヵ繧ｩ繝ｼ繝槭Φ繧ｹ縺悟ｴｩ螢 竊 LOD縺ｨ驛ｨ蛻�噪縺ｪFBX陦ｨ遉ｺ縺ｫ逡吶ａ繧具ｼ上く繝･繝ｼ繝悶ｒ蝓ｺ譛ｬ縺ｫ縺吶ｋ縲



[1]: https://www.red3d.com/cwr/steer/gdc99/?utm_source=chatgpt.com "Steering Behaviors For Autonomous Characters - red3d.com"
[2]: https://www.geeksforgeeks.org/artificial-intelligence/utility-based-agents-in-ai/?utm_source=chatgpt.com "Utility-Based Agents in AI"
[3]: https://game.engineering.nyu.edu/research/amorphous-fortress/?utm_source=chatgpt.com "Amorphous Fortress - Game Innovation Lab"
[4]: https://direct.mit.edu/artl/article/31/1/31/127798/Guideless-Artificial-Life-Model-for-Reproduction?utm_source=chatgpt.com "Guideless Artificial Life Model for Reproduction ..."
[5]: https://arxiv.org/html/2306.13169?utm_source=chatgpt.com "Observing Emergent Behavior in Multi-Agent FSMs"
## 付録: 2025-12 安定化チューニングメモ

- 初期エネルギーを繁殖閾値の 80% に引き上げ、繁殖閾値を 12、成体年齢を 5 に下げて立ち上がりを早くした。
- 繁殖確率は局所密度超過に応じて滑らかに減少する（DensityReproductionPenalty を基点に DensityReproductionSlope で逓減）。空間グリッドの近傍だけを数えるので O(N2) にはならない。
- 高エネルギー状態には追加の代謝コスト（EnergySoftCap, HighEnergyMetabolismSlope）を課し、エネルギーの積み上がりを防ぐ。
- 基礎・加齢・密度に比例する死亡ハザード（BaseDeathProbabilityPerSecond, AgeDeathProbabilityPerSecond, DensityDeathProbabilityPerNeighborPerSecond）を導入し、出生/死亡のサイクルが止まらないようにした。
- すべての処理は Simulation 側に閉じており、View は状態を読むだけで制御しない。負のフィードバックは局所情報のみで計算し、決定論的 RNG を使うためリプレイ可能。
